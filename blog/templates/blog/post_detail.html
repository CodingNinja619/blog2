{% extends "base.html" %}
{% load static %}
{% block css %}
    <link rel="stylesheet" href="{% static 'css/post_detail.css' %}">
    <script src="{% static 'js/fadeout.js' %}" defer></script>
{% endblock %}
{% block js %}
    <script
        src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
        crossorigin="anonymous" defer></script>
    <script src="{% static 'js/base.js' %}" defer></script>
    <script src="{% static 'js/add_to_read_later.js' %}" defer></script>
{% endblock %}
{% block title %}
    Post page
{% endblock %}

{% block content %}
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li {% if message.tags %} class="{{ message.tags }}" {% endif %}>
                    <div>Error</div>
                    <div>{{ message }}</div>
                </li>
            {% endfor %}
        </ul>
    {% endif %}
    <h1 class="post-title">{{post.title}}</h1>
    <div class="post-image-body">
        <div class="post-image">
            <img src="{{post.images.all.0.image.url}}" alt="">
            <div class="post-image__tags">

                {% for tag in post.tags.all %}
                    <a href="{% url 'blog:posts_by_tag' tag.name %}">{{tag.slug}}</a>
                    {% if not forloop.last %}, {% endif %}
                {% endfor %}
            </div>
        </div>
        <div class="post-body">
            {{post.body|striptags|linebreaks}}
        </div>
    </div>
    
    {% if request.user.username %}
    <div>
        <button class="my-button" id="read-later-button"
            data-post-id="{{post.id}}">
            Add to read later
        </button>
    </div>
    {% endif %}
    
    <div class="comment-section">
        <form method="post">
            {% csrf_token %}
            {% for field in form %}
                {{ field.label_tag }}
                <div>{{field}}</div>
            {% endfor %}
            <input type="submit" value="Comment" class="my-button">
        </form>
        <h2>Comments on this page</h2>
        {% for comment in comments %}
            <div class="comment">
                <div class="comment__author">{{comment.author}}</div>
                <div class="comment__body">{{ comment.body }}</div>   
            </div>
        {% endfor %}
    </div>
{% endblock %}